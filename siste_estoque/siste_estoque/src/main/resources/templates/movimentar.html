<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Movimenta√ß√£o de Estoque</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .alert-custom {
        border-left: 5px solid #ffc107;
        background-color: #fff3cd;
    }
  </style>
</head>
<body>

<div class="container mt-4">
  <!-- Menu de Navega√ß√£o -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" th:href="@{/home}">Sistema de Estoque</a>
      <div class="navbar-nav">
        <a class="nav-link" th:href="@{/componentes}">Componentes</a>
        <a class="nav-link active" th:href="@{/estoque}">Movimenta√ß√£o</a>
        <a class="nav-link" th:href="@{/estoque/historico}">Hist√≥rico</a>
        <a class="nav-link" th:href="@{/logout}">Sair</a>
      </div>
    </div>
  </nav>

  <h1>Movimenta√ß√£o de Estoque</h1>

  <!-- Mensagens de Feedback -->
  <div th:if="${sucesso}" class="alert alert-success alert-dismissible fade show">
    <span th:text="${sucesso}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div th:if="${alerta}" class="alert alert-warning alert-dismissible fade show alert-custom">
    <strong>‚ö†Ô∏è Alerta:</strong>
    <span th:text="${alerta}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div th:if="${erro}" class="alert alert-danger alert-dismissible fade show">
    <span th:text="${erro}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <!-- Formul√°rio de Movimenta√ß√£o -->
  <div class="card">
    <div class="card-body">
      <form method="post" th:action="@{/estoque/movimentar}">
        
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label"><strong>Componente *</strong></label>
            <select name="idComponente" class="form-select" required>
              <option value="">Selecione um componente...</option>
              <option th:each="c : ${componentes}" 
                      th:value="${c.id}" 
                      th:text="${c.nome + ' (Estoque: ' + c.quantidade + ', M√≠nimo: ' + c.minimo + ')'}">
              </option>
            </select>
          </div>
          
          <div class="col-md-6">
            <label class="form-label"><strong>Tipo de Movimento *</strong></label>
            <select name="tipo" class="form-select" required>
              <option value="">Selecione o tipo...</option>
              <option value="entrada">üì• Entrada no Estoque</option>
              <option value="saida">üì§ Sa√≠da do Estoque</option>
            </select>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label"><strong>Quantidade *</strong></label>
            <input type="number" name="quantidade" class="form-control" 
                   min="1" required placeholder="Digite a quantidade">
          </div>
          
          <div class="col-md-6">
            <label class="form-label"><strong>Data da Movimenta√ß√£o *</strong></label>
            <input type="date" name="dataMov" class="form-control" 
                   th:value="${#temporals.format(#temporals.createToday(), 'yyyy-MM-dd')}" 
                   required>
          </div>
        </div>

        <div class="mb-3">
          <button type="submit" class="btn btn-success btn-lg">
            üìã Registrar Movimenta√ß√£o
          </button>
          <a th:href="@{/componentes}" class="btn btn-secondary">Voltar</a>
        </div>

        <div class="alert alert-info">
          <strong>üí° Informa√ß√µes:</strong>
          <ul class="mb-0 mt-2">
            <li>Componentes listados em ordem alfab√©tica</li>
            <li>Sistema verifica automaticamente estoque m√≠nimo nas sa√≠das</li>
            <li>Entradas aumentam o estoque, sa√≠das diminuem</li>
          </ul>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de Componentes para Refer√™ncia -->
  <div class="card mt-4">
    <div class="card-header">
      <h5 class="card-title mb-0">üì¶ Componentes Cadastrados (Ordenados Alfabeticamente)</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Estoque Atual</th>
              <th>Estoque M√≠nimo</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="c : ${componentes}">
              <td th:text="${c.nome}"></td>
              <td th:text="${c.quantidade}"></td>
              <td th:text="${c.minimo}"></td>
              <td>
                <span th:if="${c.quantidade < c.minimo}" class="badge bg-danger">Abaixo do M√≠nimo</span>
                <span th:if="${c.quantidade >= c.minimo}" class="badge bg-success">Normal</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>