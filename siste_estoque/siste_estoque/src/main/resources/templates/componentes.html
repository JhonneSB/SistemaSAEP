<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Componentes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .sortable {
      cursor: pointer;
      position: relative;
      user-select: none;
      padding-right: 20px !important;
    }
    
    .sortable:hover {
      background-color: #f8f9fa;
    }
    
    .sortable::after {
      content: "↕";
      position: absolute;
      right: 8px;
      color: #6c757d;
      font-size: 0.8em;
    }
    
    .sortable.asc::after {
      content: "↑";
      color: #0d6efd;
    }
    
    .sortable.desc::after {
      content: "↓";
      color: #0d6efd;
    }
  </style>
</head>
<body class="bg-light">
  <!-- Navegação -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">Sistema de Componentes</a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link text-white" th:href="@{/home}">Início</a>
        <a class="nav-link text-white" th:href="@{/logout}">Sair</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12">
        <!-- Cabeçalho -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-white py-3">
            <div class="row align-items-center">
              <div class="col-md-6">
                <h1 class="h3 mb-0 text-primary">Gerenciar Componentes</h1>
              </div>
              <div class="col-md-6 text-md-end">
                <div class="btn-group" role="group">
                  <a th:href="@{/componentes/novo}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Novo Componente
                  </a>
                  <a th:href="@{/estoque/historico}" class="btn btn-outline-secondary">
                    <i class="fas fa-history"></i> Histórico
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Busca -->
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <form th:action="@{/componentes/buscar}" method="get">
              <div class="row g-2">
                <div class="col-md-8">
                  <input type="text" name="termo" class="form-control form-control-lg" 
                         placeholder="Buscar componente por nome..." th:value="${param.termo}">
                </div>
                <div class="col-md-4">
                  <div class="d-grid gap-2 d-md-flex">
                    <button type="submit" class="btn btn-primary btn-lg flex-fill">
                      <i class="fas fa-search"></i> Buscar
                    </button>
                    <a th:href="@{/componentes}" class="btn btn-outline-secondary btn-lg">
                      <i class="fas fa-times"></i> Limpar
                    </a>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Tabela -->
        <div class="card shadow-sm">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover table-striped mb-0" id="componentesTable">
                <thead class="table-dark">
                  <tr>
                    <th class="sortable" data-sort="0">ID</th>
                    <th class="sortable" data-sort="1">Nome</th>
                    <th class="sortable" data-sort="2">Tipo</th>
                    <th class="sortable" data-sort="3">Lote</th>
                    <th class="sortable" data-sort="4">Tensão</th>
                    <th class="sortable" data-sort="5">Quantidade</th>
                    <th class="sortable" data-sort="6">Mínimo</th>
                    <th class="text-center">Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="componente : ${componentes}">
                    <td class="fw-bold" th:text="${componente.id}"></td>
                    <td th:text="${componente.nome}"></td>
                    <td th:text="${componente.tipo}"></td>
                    <td th:text="${componente.lote}"></td>
                    <td th:text="${componente.tensao}"></td>
                    <td>
                      <span class="badge" 
                            th:classappend="${componente.quantidade <= componente.minimo} ? 'bg-danger' : 'bg-success'"
                            th:text="${componente.quantidade}">
                      </span>
                    </td>
                    <td th:text="${componente.minimo}"></td>
                    <td>
                      <div class="btn-group btn-group-sm" role="group">
                        <a th:href="@{/componentes/editar/{id}(id=${componente.id})}" 
                           class="btn btn-outline-warning">
                          <i class="fas fa-edit"></i> Editar
                        </a>
                        <a th:href="@{/componentes/excluir/{id}(id=${componente.id})}" 
                           class="btn btn-outline-danger"
                           onclick="return confirm('Tem certeza que deseja excluir este componente?')">
                          <i class="fas fa-trash"></i> Excluir
                        </a>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Mensagem quando não há componentes -->
            <div th:if="${componentes.empty}" class="text-center py-5">
              <div class="alert alert-info border-0 rounded-0 m-0">
                <i class="fas fa-info-circle fa-2x mb-3"></i>
                <h4 class="alert-heading">Nenhum componente encontrado</h4>
                <p class="mb-0">Não há componentes cadastrados no momento.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Adicionando Font Awesome para ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const table = document.getElementById('componentesTable');
      const headers = table.querySelectorAll('th.sortable');
      const tbody = table.querySelector('tbody');
      
      // Estado atual da ordenação
      let currentSort = {
        column: null,
        direction: 'asc' // 'asc' ou 'desc'
      };
      
      headers.forEach(header => {
        header.addEventListener('click', function() {
          const columnIndex = parseInt(this.getAttribute('data-sort'));
          
          // Se clicamos na mesma coluna, alternar a direção
          if (currentSort.column === columnIndex) {
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
          } else {
            // Se clicamos em uma coluna diferente, definir como ascendente
            currentSort.column = columnIndex;
            currentSort.direction = 'asc';
          }
          
          // Atualizar indicadores visuais
          headers.forEach(h => {
            h.classList.remove('asc', 'desc');
          });
          this.classList.add(currentSort.direction);
          
          // Ordenar a tabela
          sortTable(columnIndex, currentSort.direction);
        });
      });
      
      function sortTable(columnIndex, direction) {
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        rows.sort((a, b) => {
          const aValue = a.cells[columnIndex].textContent.trim();
          const bValue = b.cells[columnIndex].textContent.trim();
          
          // Verificar se os valores são numéricos (para ID, Quantidade e Mínimo)
          const isNumericColumn = columnIndex === 0 || columnIndex === 5 || columnIndex === 6;
          
          if (isNumericColumn) {
            // Comparação numérica
            const aNum = parseFloat(aValue) || 0;
            const bNum = parseFloat(bValue) || 0;
            return direction === 'asc' ? aNum - bNum : bNum - aNum;
          } else {
            // Comparação de strings (case-insensitive)
            const aStr = aValue.toLowerCase();
            const bStr = bValue.toLowerCase();
            
            if (aStr < bStr) return direction === 'asc' ? -1 : 1;
            if (aStr > bStr) return direction === 'asc' ? 1 : -1;
            return 0;
          }
        });
        
        // Remover todas as linhas atuais
        while (tbody.firstChild) {
          tbody.removeChild(tbody.firstChild);
        }
        
        // Adicionar as linhas ordenadas
        rows.forEach(row => {
          tbody.appendChild(row);
        });
      }
    });
  </script>
</body>
</html>